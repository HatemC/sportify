<div class="page-container" data-controller="switch-tab">
  <div class="page-title"><h1>Welcome Back <%= current_user.first_name %>!</h1></div>

  <div>
    <ul class="list-inline tabs-underlined">
    <li>
      <a href="#" class="tab-underlined active" data-action="click->switch-tab#showEvents" data-switch-tab-target="event">My event</a>
    </li>
    <li>
      <a href="#" class="tab-underlined" data-action="click->switch-tab#showBookings" data-switch-tab-target="booking">My booking</a>
    </li>
    </ul>
  <div>

  <div class="events-container" data-switch-tab-target="events">
  <h5>There are <%= current_user.events.count %> coming <%='event'.pluralize(current_user.events.count) %><i class="fa-solid fa-bullhorn"></i></h5>
      <% current_user.events.each do |event|  %>
      <div class="dashboard-item">

        <div class="item-description">
        <div>
          <%  if event.photo.key.nil? %>
            <%= image_tag "placeholder-image.png", crop: :fill,  class: "event-img-vertical-s" %>
          <% else  %>
            <%= cl_image_tag event.photo.key, crop: :fill,  class: "event-img-vertical-s" %>
          <% end  %>
        </div>

        <div class="flex-group">
          <div>
            <div><h5><%= event.event_name %></h5></div>
            <div><span><%= event.sport %></span></div>
            <div><span><%= event.date.strftime(' %m-%b-%Y (%a)') %><strong> 路 </strong>
            <%= event.duration %><strong> 路 </strong><%= event.level %></span></div>
          </div>

          <div class="icon-group">
          <div class="icon"><%= link_to '', event_path(event.id), class:'fa-solid fa-magnifying-glass'%></div>
          <div class="icon"><%= link_to '', edit_event_path(event.id), class: "fas fa-edit" %></div>
          <div class="icon"><%= link_to '', event_path(event.id), method: :delete, class:"fa-solid fa-trash-can", data: {confirm: "Are you sure to cancel your event?"} %></div>
          </div>

        </div>
        </div>
      </div>
      <% end %>


      <% current_user.events.each do |event|  %>
        <% booking_request = event.bookings.select { |event| !event.status } %>
         <div class="events" data-event-id="<%= event.id %>">
        <h5>There are <%= booking_request.count %> new <%='request'.pluralize(booking_request.count) %><i class="fa-solid fa-bullhorn"></i></h5>
        <% booking_request.each do |request|  %>
          <%= render 'bookings/booking', booking: request, event: event %>
        <% end%>
        </div>
      <% end %>
        </div>


  </div>


  <div class="bookings-container d-none" data-switch-tab-target="bookings">
  <h5>There are <%= current_user.bookings.count %> coming <%= 'booking'.pluralize(current_user.bookings.count) %><i class="fa-solid fa-bullhorn"></i></h5>
      <% current_user.bookings.each do |booking| %>
      <div class="dashboard-item">

        <div class="item-description">

        <div>
          <%  if booking.event.photo.key.nil? %>
            <%= image_tag "placeholder-image.png", crop: :fill,  class: "event-img-vertical-s" %>
          <% else  %>
            <%= cl_image_tag booking.event.photo.key, crop: :fill,  class: "event-img-vertical-s" %>
          <% end  %>
        </div>

        <div class="flex-group">
          <div>
            <div><h5><%= booking.event.event_name %></h5></div>
            <div><span><%= booking.event.sport %> with <%= booking.event.user.first_name%></span></div>
            <div><span><%= booking.event.date.strftime(' %m-%b-%Y (%a)') %><strong> 路 </strong>
            <%= booking.event.duration %><strong> 路 </strong><%= booking.event.level %></span></div>
            <div class="small-line"><%= booking.status ? 'Status: booked' : 'Status: pending'  %></div>
          </div>
          <div class="icon-group">
          <div class="icon"><%= link_to '', event_path(booking.event.id), class:'fa-solid fa-magnifying-glass'%></div>
          <div class="icon"><%= link_to '', booking_path(booking.id), method: :delete, class:"fa-solid fa-trash-can", data: {confirm: "Are you sure to cancel?"} %></div>
          </div>
        </div>
        </div>
      <% end %>
  <%# </div> %>

<div>
