<div class="page-container" data-controller="switch-tab">
  <div class="page-title"><h1>Welcome Back <%= current_user.first_name %>!</h1></div>

  <div>
    <ul class="list-inline tabs-underlined">
    <li>
      <a href="#" class="tab-underlined active" data-action="click->switch-tab#showEvents" data-switch-tab-target="event">My event</a>
    </li>
    <li>
      <a href="#" class="tab-underlined" data-action="click->switch-tab#showBookings" data-switch-tab-target="booking">My booking</a>
    </li>
    </ul>
  <div>

  <div class="events-container" data-switch-tab-target="events">
  <h5>There are <%= current_user.events.count %> coming <%='event'.pluralize(current_user.events.count) %><i class="fa-solid fa-bullhorn"></i></h5>
      <% current_user.events.each do |event|  %>
      <div class="dashboard-item">

        <div class="item-description">
        <div>
          <%  if event.photo.key.nil? %>
            <%= image_tag "placeholder-image.png", crop: :fill,  class: "event-img-vertical-s" %>
          <% else  %>
            <%= cl_image_tag event.photo.key, crop: :fill,  class: "event-img-vertical-s" %>
          <% end  %>
        </div>

        <div class="flex-group">
          <div>
            <div><h5><%= event.event_name %></h5></div>
            <div><span><%= event.sport %></span></div>
            <div><span><%= event.date.strftime(' %m-%b-%Y (%a)') %><strong> 路 </strong>
            <%= event.duration %><strong> 路 </strong><%= event.level %></span></div>
          </div>

          <div class="icon-group">
          <div class="icon"><%= link_to '', event_path(event.id), class:'fa-solid fa-magnifying-glass'%></div>
          <div class="icon"><%= link_to '', edit_event_path(event.id), class: "fas fa-edit" %></div>
          <div class="icon"><%= link_to '', event_path(event.id), method: :delete, class:"fa-solid fa-trash-can", data: {confirm: "Are you sure to delete your offer?"} %></div>
          </div>

        </div>
        </div>
      </div>
      <% end %>
  </div>


  <div class="bookings-container d-none" data-switch-tab-target="bookings">
  <h5>There are <%= current_user.bookings.count %> coming <%= 'booking'.pluralize(current_user.bookings.count) %><i class="fa-solid fa-bullhorn"></i></h5>
      <% current_user.bookings.each do |booking| %>
      <div class="dashboard-item">

        <div class="item-description">

        <div>
          <%  if booking.event.photo.key.nil? %>
            <%= image_tag "placeholder-image.png", crop: :fill,  class: "event-img-vertical-s" %>
          <% else  %>
            <%= cl_image_tag booking.event.photo.key, crop: :fill,  class: "event-img-vertical-s" %>
          <% end  %>
        </div>

        <div class="flex-group">
          <div>
            <div><h5><%= booking.event.event_name %></h5></div>
            <div><span><%= booking.event.sport %> with <%= booking.event.user.first_name%></span></div>
            <div><span><%= booking.event.date.strftime(' %m-%b-%Y (%a)') %><strong> 路 </strong>
            <%= booking.event.duration %><strong> 路 </strong><%= booking.event.level %></span></div>
            <div class="small-line"><%= booking.status ? 'status: booked' : 'status: pending'  %></div>
          </div>
          <div class="icon-group">
          <div class="icon"><%= link_to '', event_path(booking.event.id), class:'fa-solid fa-magnifying-glass'%></div>
          <div class="icon"><%= link_to '', booking_path(booking.id), method: :delete, class:"fa-solid fa-trash-can", data: {confirm: "Are you sure to cancel?"} %></div>
          </div>
        </div>
        </div>
      <% end %>
  <%# </div> %>

<div>


  <div class="container">

  <h5>My <%= 'Request'.pluralize(current_user.events.count) %></h5>
      <% current_user.events.each do |event|  %>
        <div class="dashboard-item">

          <% event.bookings.each do |request|  %>
           <% if !request.status %>
            <% request_user = User.find(request.user_id) %>
            <div class="item-description">
             <div>
                <%  if current_user.photo.key.nil? %>
                  <%= image_tag "default_profil.png", crop: :fill,  class: "event-img-vertical-s" %>
                <% else  %>
                  <%= cl_image_tag request_user.photo.key, crop: :fill,  class: "event-img-vertical-s" %>
                <% end  %>
              </div>

              <div class="flex-group">
                <div>
                  <div><h5><%= event.event_name %></h5></div>
                  <div><span><%= event.sport %></span></div>

                  <p> Booking request from <%= request_user.first_name %> </p>
                 </div>
                <div>

                    <%= link_to "Accept", booking_path(request, booking: {status: true}), method: :patch, class:'btn btn-primary' %>

                  </div >
                </div>

                </div>
              </div>

            <% end %>
          <% end%>

        </div>
      <% end %>
  </div>
